<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=80mm, initial-scale=1.0">
    <title>Recibo de Pago - Pedido #{{ pago.pedido.id }}</title>
    <style>
        /* Estilos optimizados para impresora térmica 80mm */
        @media print {
            .no-print {
                display: none;
            }
            body {
                font-size: 10pt;
                margin: 0;
                padding: 0;
                width: 80mm;
                font-family: 'Courier New', monospace;
            }
            .container {
                width: 80mm;
                margin: 0;
                padding: 0;
            }
            .receipt {
                width: 80mm;
                max-width: 80mm;
                margin: 0;
                padding: 2mm;
                box-shadow: none;
                background-color: white;
            }
            .receipt-header h3 {
                font-size: 12pt;
                margin: 0 0 2mm 0;
            }
            .receipt-header p {
                font-size: 9pt;
                margin: 1mm 0;
            }
            .receipt-item {
                font-size: 9pt;
                line-height: 1.2;
            }
            .receipt-total {
                font-size: 10pt;
            }
            .receipt-footer p {
                font-size: 8pt;
                margin: 1mm 0;
            }
        }

        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 80mm;
            margin: 0 auto;
            padding: 5mm;
        }

        .receipt {
            width: 80mm;
            max-width: 80mm;
            margin: 0 auto;
            padding: 3mm;
            background-color: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            font-size: 11pt;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 3mm;
        }

        .receipt-header h3 {
            font-size: 14pt;
            margin: 0 0 2mm 0;
            font-weight: bold;
        }

        .receipt-header p {
            margin: 1mm 0;
            font-size: 10pt;
        }

        .receipt-footer {
            text-align: center;
            margin-top: 3mm;
        }

        .receipt-footer p {
            margin: 1mm 0;
            font-size: 9pt;
        }

        .receipt-divider {
            border-top: 1px dashed #000;
            margin: 3mm 0;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1mm;
            font-size: 10pt;
            line-height: 1.3;
            word-wrap: break-word;
        }

        .receipt-item span:first-child {
            flex: 1;
            padding-right: 2mm;
        }

        .receipt-item span:last-child {
            white-space: nowrap;
            font-weight: bold;
        }

        .receipt-total {
            font-weight: bold;
            margin-top: 3mm;
        }

        .receipt-total .receipt-item {
            font-size: 11pt;
            margin-bottom: 2mm;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="receipt">
            <div class="receipt-header">
                <h3>{{ request.site.name|default:"Cafeteria Leche y Miel" }}</h3>
                <p>{{ empresa.direccion|default:"Colin s/n" }}</p>
                <p><strong>RECIBO DE PAGO</strong></p>
                <p>{{ pago.fecha|date:"d/m/Y H:i" }}</p>
            </div>
        
            <div class="receipt-divider"></div>
        
            <div>
                <p><strong>Pedido #: {{ pago.pedido.id }}</strong></p>           
                {% if pago.pedido.mesa %}
                    <p><strong>Mesa: {{ pago.pedido.mesa }}</strong></p>
                {% else %}
                    <p><strong>{{ pago.pedido.tipo_orden.nombre }}{% if pago.pedido.numero_orden %} - {{ pago.pedido.numero_orden }}{% endif %}</strong></p>
                    {% if pago.pedido.nombre_cliente %}
                        <p><strong>Cliente: {{ pago.pedido.nombre_cliente }}</strong></p>
                    {% endif %}
                {% endif %}
            
                <div class="receipt-divider"></div>
            
                {% for detalle in detalles_activos %}
                    <div class="receipt-item">
                        <span>{{ detalle.cantidad }}x {{ detalle.producto.nombre|truncatechars:25 }}</span>
                        <span>${{ detalle.subtotal|floatformat:0 }}</span>
                    </div>
                {% endfor %}
            
                <div class="receipt-divider"></div>
            
                <div class="receipt-total">               
                    <div class="receipt-item">
                        <span><strong>TOTAL:</strong></span>
                        <span><strong>${{ total_correcto|floatformat:0 }}</strong></span>
                    </div>    

                    <div class="receipt-item">
                        <span><strong>ESTADO:</strong></span>
                        <span><strong>PAGADO</strong></span>
                    </div>
                
                    {% if pago.metodo == 'efectivo' and pago.monto_recibido %}
                    <div class="receipt-item">
                        <span>EFECTIVO:</span>
                        <span>${{ pago.monto_recibido|floatformat:0 }}</span>
                    </div>
                    <div class="receipt-item">
                        <span>CAMBIO:</span>
                        <span>${{ cambio_correcto|floatformat:0 }}</span>
                    </div>
                    {% else %}
                    <div class="receipt-item">
                        <span>PAGO:</span>
                        <span>{{ pago.get_metodo_display }}</span>
                    </div>
                    {% endif %}
                </div>
            
                <div class="receipt-divider"></div>
            
                <div class="receipt-footer">
                    <p>Atendido: {{ pedido.mesero.get_full_name|truncatechars:20 }}</p>
                    {% if pedido.cajero %}
                    <p>Cobrado: {{ pedido.cajero.get_full_name|truncatechars:20 }}</p>
                    {% endif %}
                    <p><strong>¡Gracias por su preferencia!</strong></p>
                    <p>Lo esperamos pronto</p>
                    <p>{{ pago.fecha|date:"d/m/Y H:i" }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Imprimir automáticamente al cargar la página
        window.onload = function() {
            setTimeout(function() {
                window.print();
            }, 1000);
        };
    </script>
</body>
</html>